---
format: gfm
---

```{r}
#| include: false
library(tidyverse)
action <- yaml::read_yaml("action.yml")
action_name <- basename(getwd())
```

# `r action_name`

<!--
DO NOT EDIT THIS FILE MANUALLY!
This README was generated by running `make`
-->

`r action$description`

## Usage

This action will run `viash ns list`. See the reference documentation on [ns list](https://viash.io/reference/viash/ns.html) for more info on each of the arguments.

We recommend using a Linux or MacOS runner if possible.

### Inputs

```{r}
#| echo: false
lines <- map_chr(names(action$inputs), function(name) {
  input <- action$inputs[[name]]
  required <- ifelse (input$required %||% FALSE, "required", "optional")
  glue::glue("* `{name}`: - _{required}_. {input$description}")
})
knitr::asis_output(paste0(lines, collapse = "\n"))
```

### Outputs

```{r}
#| echo: false
lines <- map_chr(names(action$outputs), function(name) {
  output <- action$outputs[[name]]
  glue::glue("* `{name}`: {output$description}")
})
knitr::asis_output(paste0(lines, collapse = "\n"))
```

## Usage

```yaml
name: Demo of `r action_name`

on:
  push:

jobs:
  nslist:
    runs-on: ubuntu-latest

    outputs:
      output_file: ${{ steps.ns_list.outputs.output_file }}
      output_matrix: ${{ steps.ns_list.outputs.output_matrix }}
    
    steps:
      - name: Install Viash
        uses: viash-io/viash-actions/setup@v3

      - name: Check out repository
        uses: actions/checkout@v3

      - name: `r action$name`
        uses: viash-io/viash-actions/ns-list@v3

      - name: View output
        run: |
          cat "${{steps.ns_list.outputs.output_file}}"
  
  use_matrix:
    runs-on: ubuntu-latest
    needs: nslist
    
    strategy:
      matrix:
        component: ${{fromJson(needs.nslist.outputs.output_matrix)}}

    steps:
      - name: Do something for every component
        run: |
          echo "Name: ${{ matrix.component.name }}"
          echo "Namespace: ${{ matrix.component.namespace }}"
          echo "Runner: ${{ matrix.component.runner }}"
          echo "Engine: ${{ matrix.component.engine }}"
          echo "Config: ${{ matrix.component.config }}"
          echo "Executable: ${{ matrix.component.executable }}"
          echo "Src dir: ${{ matrix.component.src_dir }}"
          echo "Target dir: ${{ matrix.component.target_dir }}"
          echo "Full name: ${{ matrix.component.full_name }}"
```
